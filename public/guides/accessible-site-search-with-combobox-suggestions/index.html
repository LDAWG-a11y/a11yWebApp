<!doctype html><html lang="en" class="no-js"><head><title>Accessible site search with combobox suggestions | Make Things Accessible</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#702A8C"><meta name="description" content="A common UI pattern is a site search input that comes with a list of suggestions, where each suggestion is a link. Let&#39;s look at what we need to consider"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="color-scheme" content="light dark"><script>document.documentElement.classList.remove('no-js');
    document.documentElement.classList.add('has-js');
    
    if (localStorage.getItem('theme')) {
      localStorage.setItem('data-pref--theme', localStorage.getItem('theme'));
      localStorage.removeItem('theme');
    }

    if (localStorage.getItem('data-pref--theme')) {
      document.documentElement.setAttribute('data-pref--theme', localStorage.getItem('data-pref--theme'))
    }</script><link rel="preload" href="/fonts/oswald-v49-latin-600.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"><link rel="canonical" href="https://www.makethingsaccessible.com/guides/accessible-site-search-with-combobox-suggestions/"><meta property="og:title" content="Accessible site search with combobox suggestions | Make Things Accessible"><meta property="og:description" content="A common UI pattern is a site search input that comes with a list of suggestions, where each suggestion is a link. Let&#39;s look at what we need to consider"><meta property="og:url" content="https://www.makethingsaccessible.com/guides/accessible-site-search-with-combobox-suggestions/"><meta property="og:locale" content="en_GB"><meta property="og:site_name" content="Make Things Accessible"><meta property="og:type" content="website"><meta property="og:image" content="https://www.makethingsaccessible.com/img/social-logo.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="Make Things Accessible"><meta name="twitter:description" content="Accessible site search with combobox suggestions | Make Things Accessible"><meta name="twitter:image" content="https://www.makethingsaccessible.com/img/social-logo.jpg"><meta name="twitter:image:alt" content="Make Things Accessible logo"><meta name="generator" content="Eleventy"><script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "Article",
        "name": "Accessible site search with combobox suggestions",
        "author": {
          "@type": "Person",
          "name": "Darren Lee"
        },
        "datePublished": "2024-01-10T00:00:00.000Z"
      }</script></head><body><header class="header"><a class="skip-link" href="#h1">Skip navigation</a><nav class="nav"><button class="nav__prefs-btn" id="prefsBtn"><svg width="32px" height="32px" viewBox="0 0 32 32" focusable="false" aria-hidden="true"><path d="M 30.460938 19.730469 L 27.800781 18.195312 C 28.070312 16.742188 28.070312 15.257812 27.800781 13.804688 L 30.460938 12.269531 C 30.769531 12.09375 30.90625 11.730469 30.804688 11.394531 C 30.113281 9.167969 28.929688 7.15625 27.386719 5.480469 C 27.148438 5.226562 26.761719 5.164062 26.460938 5.335938 L 23.800781 6.875 C 22.679688 5.914062 21.394531 5.167969 20 4.679688 L 20 1.613281 C 20 1.261719 19.757812 0.957031 19.414062 0.882812 C 17.117188 0.367188 14.769531 0.394531 12.585938 0.882812 C 12.242188 0.957031 12 1.261719 12 1.613281 L 12 4.6875 C 10.613281 5.179688 9.324219 5.925781 8.199219 6.882812 L 5.542969 5.34375 C 5.238281 5.167969 4.855469 5.226562 4.617188 5.488281 C 3.074219 7.15625 1.894531 9.167969 1.199219 11.398438 C 1.09375 11.738281 1.238281 12.101562 1.542969 12.273438 L 4.207031 13.8125 C 3.9375 15.261719 3.9375 16.75 4.207031 18.199219 L 1.542969 19.738281 C 1.238281 19.914062 1.101562 20.273438 1.199219 20.613281 C 1.894531 22.835938 3.074219 24.851562 4.617188 26.523438 C 4.855469 26.78125 5.242188 26.84375 5.542969 26.667969 L 8.207031 25.132812 C 9.324219 26.09375 10.613281 26.835938 12.007812 27.324219 L 12.007812 30.398438 C 12.007812 30.75 12.25 31.054688 12.59375 31.132812 C 14.886719 31.644531 17.238281 31.617188 19.417969 31.132812 C 19.761719 31.054688 20.007812 30.75 20.007812 30.398438 L 20.007812 27.324219 C 21.394531 26.832031 22.679688 26.085938 23.804688 25.132812 L 26.46875 26.667969 C 26.773438 26.84375 27.15625 26.789062 27.394531 26.523438 C 28.9375 24.855469 30.117188 22.84375 30.8125 20.613281 C 30.90625 20.269531 30.769531 19.90625 30.460938 19.730469 Z M 16 21 C 13.242188 21 11 18.757812 11 16 C 11 13.242188 13.242188 11 16 11 C 18.757812 11 21 13.242188 21 16 C 21 18.757812 18.757812 21 16 21 Z M 16 21 "/></svg> <span class="visually-hidden">Settings</span></button> <button class="nav__menu-btn" id="navBtn" aria-controls="navPanel" aria-expanded="false" data-untouched><span class="nav__menu-bar"></span> <span class="visually-hidden">Menu</span></button><div class="nav__wrapper" id="navPanel"><ul class="nav__list"><li class="nav__item"><a class="nav__link" href="/">Home</a></li><li class="nav__item"><a class="nav__link" href="/about/">About</a></li><li class="nav__item"><a class="nav__link" href="/guides/">Guides</a></li><li class="nav__item"><a class="nav__link" href="/faqs/">FAQs</a></li><li class="nav__sub-items--parent"><button class="nav__btn--collab" aria-expanded="false" aria-controls="collabNavPanel" id="collabBtn">Collaborations</button><div class="nav__list-sub-panel" id="collabNavPanel"><ul class="nav__list--level-2"><li><h2 class="nav__list-collaborator" data-no-accent>Access and Assistance for All</h2><ul class="nav__list--level-3"><li><a class="nav__link-sub" href="/aaa/">AAA Home</a></li><li><a class="nav__link-sub" href="/aaa/roles/">AAA Roles</a></li><li><a class="nav__link-sub" href="/aaa/student-stories/">AAA Student Stories</a></li><li><a class="nav__link-sub" href="/aaa/supporters/">AAA Supporters</a></li></ul></li></ul></div></li></ul></div></nav><picture class="header__logo"><source media="(prefers-color-scheme: light)" srcset="/img/MTA-logo-light.webp" height="136" width="600" data-main-logo><source media="(prefers-color-scheme: light)" srcset="/img/MTA-logo-light.png" height="136" width="600" data-main-logo><source media="(prefers-color-scheme: dark)" srcset="/img/MTA-logo-dark.webp" height="136" width="600" data-main-logo><source media="(prefers-color-scheme: dark)" srcset="/img/MTA-logo-dark.png" height="136" width="600" data-main-logo><img src="/img/MTA-logo-light.png" height="136" width="600" alt="Make Things Accessible, logo"></picture><div class="header__search-block"><label id="sFilterLbl" for="sFilter" class="search__label">Search for Guides or Tags, by keyword</label><div class="search__wrapper" data-expanded="false"><input class="search__input" id="sFilter" type="text" autocomplete="off"> <svg aria-hidden="true" focusable="false" stroke="#000" stroke-width="9.8" viewBox="-19.6 -19.6 529.6 529.6" height="1.25rem"><path d="M484.1 454.8 373.6 344.2a210.6 210.6 0 1 0-29.2 29.2l110.5 110.5c12.9 11.8 25 4.2 29.2 0a20 20 0 0 0 0-29.1zm-443-244a169.5 169.5 0 1 1 339 0 169.5 169.5 0 0 1-339 0z"/></svg></div></div></header><main class="main"><div class="guide__info-panel"><div class="guide__author"><strong>By: </strong><a href="/authors/dlee">Darren Lee</a></div><div class="guide__date"><strong>Posted: </strong><time datetime="2024-01-10T00:00:00.000Z">Wed, Jan 10, 2024</time></div><strong class="guide__label">Tagged with:</strong><ul class="tags tags__all"><li class="tag__item"><a href="/tags/html/" class="tag__link">HTML</a></li><li class="tag__item"><a href="/tags/aria/" class="tag__link">ARIA</a></li><li class="tag__item"><a href="/tags/javascript/" class="tag__link">JavaScript</a></li><li class="tag__item"><a href="/tags/component/" class="tag__link">Component</a></li></ul></div><nav class="cms__toc" aria-labelledby="toc-heading"><details open><summary id="toc-heading">Table of contents</summary><ol><li><a href="#site-search-with-suggestions">Site search with suggestions</a></li><li><a href="#ok-how-will-ours-differ">Ok, how will ours differ?</a></li><li><a href="#lets-look-at-some-other-site-searches-from-around-the-web">Let's look at some other site searches from around the web</a></li><li><a href="#overview-of-site-searches">Overview of site searches</a></li><li><a href="#how-should-we-build-one">How should we build one?</a></li><li><a href="#lets-build-some-examples">Let's build some examples</a></li><li><a href="#wrapping-up">Wrapping up</a></li></ol></details></nav><article class="cms"><div class="cms__anchor-wrapper"><h2 id="site-search-with-suggestions" tabindex="-1">Site search with suggestions</h2><a class="cms__anchor" href="#site-search-with-suggestions" aria-labelledby="site-search-with-suggestions"><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="4 14 40 20"><path d="M22.5 34H14q-4.2 0-7-3t-3-7q0-4.2 3-7t7-3h8.5v3H14q-2.9 0-5 2-2 2.1-2 5t2 5q2.1 2 5 2h8.5Zm-6.3-8.5v-3h15.6v3Zm9.3 8.5v-3H34q2.9 0 5-2 2-2.1 2-5t-2-5q-2.1-2-5-2h-8.5v-3H34q4.2 0 7 3t3 7q0 4.2-3 7t-7 3Z"></path></svg></a></div><p>We have all encountered those site search patterns where as we start typing or focus on the input, a box displays underneath the input and it will filter suggestions based upon the characters typed into the input. All major search engines use these patterns, so when you Google something, Bing it (that will never sound right) or whatever else, you'll typically start typing into an input and it will display suggestions, based upon matching the characters you have typed against suggestions. They are of course also very common on eCommerce sites and most sites where there is a tonne of content.</p><p>Functionally, they act almost identical to the combobox pattern, with one major difference, a <code>combobox</code> with a <code>listbox</code> displays a list of items with <code>role=&quot;option&quot;</code> and it will do something on that page or set a selection when a user makes their choice, a site search with suggestions will navigate to a new page; be that a results page or directly to the exact page.</p><p>I couldn't talk about comboboxes without linking to <a href="https://sarahmhigley.com/writing/select-your-poison/">Sarah Higley's amazing deep dive into comboboxes</a>, this is my goto for most <code>combobox</code> recommendations, as it is super detailed. Sarah's comboboxes are for displaying suggestions for options, that will change the setting of that input, not something that will navigate to a new URL, so this guide does differ somewhat, but mostly because I'm not as smart as Sarah.</p><div class="cms__anchor-wrapper"><h2 id="ok-how-will-ours-differ" tabindex="-1">Ok, how will ours differ?</h2><a class="cms__anchor" href="#ok-how-will-ours-differ" aria-labelledby="ok-how-will-ours-differ"><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="4 14 40 20"><path d="M22.5 34H14q-4.2 0-7-3t-3-7q0-4.2 3-7t7-3h8.5v3H14q-2.9 0-5 2-2 2.1-2 5t2 5q2.1 2 5 2h8.5Zm-6.3-8.5v-3h15.6v3Zm9.3 8.5v-3H34q2.9 0 5-2 2-2.1 2-5t-2-5q-2.1-2-5-2h-8.5v-3H34q4.2 0 7 3t3 7q0 4.2-3 7t-7 3Z"></path></svg></a></div><p>I'm going to build three different examples using different patterns, unfortunately this is not a guide that can provide a &quot;solution&quot; as such, it's a guide that provides three options, but if using in the wild, I cannot stress enough that these would need to be tested with disabled users to determine which approach is the best for them. I don't have the luxury of a budget to pay for user testing so these are just concepts, for further exploration by you and your team. In isolation, they may all have at least one issue or grey area, but on an actual site those issues may or may not be problematic, depending on other factors. So, this is a proceed with caution warning.</p><h3>Probable WCAG failure?</h3><p>Should we opt for a combobox with role=&quot;option&quot; elements we actually run the risk of a WCAG failure. Looking at <a href="https://www.w3.org/WAI/WCAG22/Understanding/on-input.html">WCAG 3.2.2 On Input (A)</a>, it states &quot;Changing the setting of any user interface component does not automatically cause a change of context unless the user has been advised of the behaviour before using the component.&quot; It then goes on to state that &quot;So checking a checkbox, entering text into a text field, or changing the selected option in a list control changes its setting, but activating a link or a button does not&quot;.</p><p>As we would navigate to a new URL by clicking one of the &quot;options&quot;, that of course is a change of context, and as the item a user clicks is an &quot;option&quot;, then this is where the failure occurs. The pattern is actually very common, albeit with some implementation differences and given that there may well be other information provided to inform a user that clicking one of these items will navigate to a new page, is that information enough?</p><p>The only user group that may ever know the item they are clicking is an &quot;option&quot; are of course screen reader users (I'm not counting folks who open up the Inspector/DevTools) and in some instances the <code>role=&quot;option&quot;</code> isn't announced at all.</p><p>Whilst WCAG is super useful because we need a minimum standard to test against, there may be times where something &quot;technically&quot; fails a success criterion, but is actually perfectly understandable and usable for disabled and non-disabled folks alike. This pattern is in use across major search engines (it does differ slightly) and typically a user of the web will be familiar with how to use a search engine, whether they actually use the suggestions or not is information I don't have, they could certainly be useful to all users, but some folks may just ignore them completely.</p><div class="cms__anchor-wrapper"><h2 id="lets-look-at-some-other-site-searches-from-around-the-web" tabindex="-1">Let's look at some other site searches from around the web</h2><a class="cms__anchor" href="#lets-look-at-some-other-site-searches-from-around-the-web" aria-labelledby="lets-look-at-some-other-site-searches-from-around-the-web"><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="4 14 40 20"><path d="M22.5 34H14q-4.2 0-7-3t-3-7q0-4.2 3-7t7-3h8.5v3H14q-2.9 0-5 2-2 2.1-2 5t2 5q2.1 2 5 2h8.5Zm-6.3-8.5v-3h15.6v3Zm9.3 8.5v-3H34q2.9 0 5-2 2-2.1 2-5t-2-5q-2.1-2-5-2h-8.5v-3H34q4.2 0 7 3t3 7q0 4.2-3 7t-7 3Z"></path></svg></a></div><p>I'll discuss several different implementations here, just to show how there isn't a universally agreed pattern and how each organisation has approached the issue. There will be limitations with my findings here, in that visually, they all look somewhat the same, as there is an input which will display a panel of suggestions below it. Non-screen reader users will generally be familiar with the pattern, they have no idea what roles and properties the components use, as much of this information is only communicated to screen readers, although ARIA etc can of course affect other assistive technologies.</p><p>The information that is passed to a screen reader comes from the roles and properties, a screen reader user who cannot see the interface will of course rely on certain roles and properties, along with names and states to understand a component, its purpose and how to interact with it. I cannot speak for screen reader users and I have no anecdotal evidence to suggest any of the following patterns are more or less accessible than another to a screen reader user. I'm just making observations and this is primarily to discuss the different patterns in use across popular sites.</p><p>It is of course safe to say that if the suggestions offer value to some users, then that same value must be afforded to all users, so in the case of a screen reader user that cannot see the suggestions appear and filtering taking place, they need to know they are there and how to get to them should they wish to use them.</p><h3>Apple</h3><p>I accessed the <a href="https://www.apple.com/">apple.com</a> site and tabbed to the &quot;Search <a href="http://Apple.com">Apple.com</a>&quot; button, which is located in the site's header, this button is visually presented as a magnifying glass. When I click that button (or link with <code>role=&quot;button&quot;</code> as it actually is) the search panel expands into view. I am presented with a text input and below that input is a list of &quot;Quick links&quot;.</p><p>Once I start typing in the input, that list of Quick Links then becomes a list of &quot;Suggested Searches&quot;, which starts filtering based upon the characters I type. Looking at the code in the Web Inspector I can see that Apple has not gone for the ARIA <code>combobox</code> pattern at all, it's simply a text input and an unrelated list of suggestions, well they are all wrapped in a <code>&lt;form&gt;</code> element, so I guess there is some relationship there, but is that relationship programmatically determinable? I wouldn't say it is.</p><p>Upon typing to narrow down results, if I pause typing whilst VoiceOver is running, it does announce &quot;[Count of] total results&quot; and pressing the down arrow will move visual focus to the items in the suggestions list enabling me to navigate to them like I would a <code>combobox</code>. So there is some audible information that provides a screen reader user with information that may help them understand the component.</p><p>Is there enough information here for a screen reader user to understand the pattern? A sighted user who started typing and saw the suggestions change can indeed find that useful. But what about a screen reader user? They would typically rely on roles and properties to understand relationships and interaction patterns. These suggestions can also be reached with the <kbd>Tab</kbd> key too, so even if the user was unaware they could use the arrow keys, they could also find the suggestions by tabbing to them. The five suggestions are quite restrictive though, in that five is a small number, it is quite possible to type a few characters, tab through the two buttons into the suggestions list and discover that the characters you typed weren't quite granular enough to filter down the suggestions to exactly what you wanted. Because you used the <kbd>Tab</kbd> key, you can't just continue typing to further filter, you have to <kbd>Shift</kbd> &amp; <kbd>Tab</kbd> back up into the input and maybe at this stage, our screen reader user would be wondering why they bothered attempting to use the suggestions at all?</p><p>Perhaps Apple found this pattern to be better for screen reader users after user-testing with them, assuming they did? Maybe they used this pattern because of the On Input issue? Maybe they used this pattern as their browsers don't support <code>aria-activedescendant</code> (yet) Whatever their reason, it is an interesting approach and I am curious how screen reader users would rate this approach compared to others.</p><p>The Apple search does navigate to a results page, as opposed to a specific page and despite Apple being one of the largest companies on the planet, the number of products they sell is actually quite small. Should a user wish to buy a new phone, laptop or tablet etc, they likely would use the main navigation links which precede the search input and direct a user to the product page. There are of course a large number of pages that provide helpful information on how to use the products or services Apple sell, so a user looking for guidance on how to use some specific functionality would likely have to interact with the search input.</p><h3>Google</h3><p>Using the <a href="https://www.google.com/">Google.com</a> search page, this one uses a somewhat similar combobox pattern to Sarah's, although this one still has <code>aria-owns</code> which was only recommended in an older ARIA spec. If you read Sarah's article (fully), which I hope you did, she points out the issue with using <code>aria-owns</code> on an input, which of course creates a parent-child relationship and this was problematic. Now in ARIA 1.2, we use <code>aria-controls</code>, which just means in layman's terms if you interact with this thing, it will also have an effect on this other thing, that isn't a child. Google have opted for both <code>aria-controls</code> and <code>aria-owns</code>, the reason for that is unclear to me.</p><p>This actually fails On Input simply because it is an &quot;option&quot;, but it's only an &quot;option&quot; programmatically, in that visually it doesn't look like a <code>&lt;select&gt;</code> and <code>&lt;option&gt;</code> pattern as the operating system styles a list of <code>&lt;option&gt;</code>s in its own way, whereas these are fully custom elements that the developers have full control over. Would a user that does not use a screen reader have any idea they are &quot;option&quot; elements? No, of course not, so are their user expectations met when they start typing into the field and the suggestions display, would they expect to click a suggestion and navigate to a new page? I think given that this type of component is commonplace and this is a search engine, a sighted user would expect that behaviour. It's likely a screen reader user can also expect that, given it is a search engine and typing in a search input will navigate to a new page.</p><p>Quite interestingly, with VoiceOver/Safari, the only thing announced is the actual text. The <code>role=&quot;option&quot;</code> is present on the suggestions, but it's just not being passed to VoiceOver The reason this is happening is because as a user arrows up or down in the suggestions, the value of the input changes to match the text of the current &quot;option&quot;, so that change in value is what is actually announced. So, this is more of an &quot;Inline autocomplete&quot;, as was discussed in Sarah's article.</p><p>Should I use up and down arrows with NVDA and Firefox, I do hear the list enumeration and the suggestion text, still not the role of &quot;option&quot; though, even though it is present. Arguably as a user does not hear it is an &quot;option&quot; maybe this mitigates the confusion for them? I don't have access to JAWS, so I am unable to determine what, if any differences are output with that screen reader.</p><p>Despite it &quot;technically&quot; being a failure, is it actually a &quot;problem&quot; for users? Ultimately, usability trumps compliance and only disabled folks can answer that. The fallback here is that search engines are pretty clever, should a user choose not to use the suggestions and even make a typo, the search engine will navigate to a results page and either ask if you meant [correctly typed term]? or just figure it out for you.</p><h3>MDN</h3><p>Many of us are familiar with <a href="https://developer.mozilla.org/en-US/">MDN (Mozilla Developer Network)</a>, as we may visit often to learn syntax or understand something related to web technologies a little better. MDN have a search filter in their site header and looking at the HTML for the input alone, it contains all of the roles and properties that an ARIA 1.2 <code>combobox</code> uses. Where this one gets a problematic is the actual suggestions in the related <code>listbox</code>, have the correct <code>role=&quot;option&quot;</code> children, as are required (you can also use <code>role=&quot;group&quot;,</code> but that must contain <code>role=&quot;option&quot;</code> children), but interestingly, MDN have decided to place a link inside the <code>role=&quot;option&quot;</code> elements.</p><p>As <code>role=&quot;option&quot;</code> is fundamentally the same as an <code>&lt;option&gt;</code> as far as assistive technologies are concerned it is only allowed presentational children, not interactive elements. Whilst a <code>role</code> in itself doesn't really alter the way something behaves, the expectation from the user agent is that you make this item interactive, after all, it is an &quot;option&quot; and options can be selected. As the ARIA spec and user agents expect this element to be interactive, popping another interactive element inside it is actually invalid ARIA and of course when we use ARIA, we need to do so responsibly, as the effects can have all manner of consequences for disabled users.</p><p>Similar to the Google pattern, this does not announce the role of &quot;option&quot; or even &quot;link&quot; it contains, it reports each item as a text element in VoiceOver. Quite annoyingly, it doesn't work correctly, in that with VoiceOver running, if I press down arrow, it closes the suggestions panel, so I have to navigate to the options using the virtual cursor and then get into the <code>listbox</code>. the problem with that is the input now doesn't have focus, so a user cannot continue typing to further filter the suggestions.</p><p>In Firefox with NVDA, I can at least use the up and down arrows and again, there is no role announced, just the text and list enumeration.</p><p>Whilst it works similar to the Google search (albeit this implementation takes a user directly to a specific page), the nested <code>&lt;a&gt;</code> element sits uncomfortably with me, I'm struggling to see why they took this approach, as it isn't necessary at all. Sure, links provide us with out-of-the-box interactivity, which is useful here, but they could have just added the <code>role=&quot;option&quot;</code> to the link elements to preserve the functionality and also provide the required ARIA children for the <code>listbox</code>, I'll demo this later. It's still technically a failure, as an option is navigating, but less of a failure than nesting interactive elements in my opinion.</p><h3>Amazon</h3><p>Amazon does not use the combobox pattern for their site search, typing a few characters into the field with VoiceOver running unfortunately did not give any audible indication that there were suggestions present. If a user does not know these helpful suggestions are present, then they're not helpful to them at all. As with all of the other examples, somebody could argue that there is an &quot;alternative way&quot; in that the user can search by using the input, but that's still not comparable, because there's no &quot;shortcut&quot;, so to speak. I'm just a lazy web user, I don't need shortcuts, but I appreciate them. A person with a disability would in many cases benefit from actually being able to use these handy shortcuts way more than a lazy web user, like me.</p><p>This one is quite disappointing, even if it simply announced the presence of the suggestions, like Apple's it would at least give users a clue to there were suggestions present.</p><div class="cms__anchor-wrapper"><h2 id="overview-of-site-searches" tabindex="-1">Overview of site searches</h2><a class="cms__anchor" href="#overview-of-site-searches" aria-labelledby="overview-of-site-searches"><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="4 14 40 20"><path d="M22.5 34H14q-4.2 0-7-3t-3-7q0-4.2 3-7t7-3h8.5v3H14q-2.9 0-5 2-2 2.1-2 5t2 5q2.1 2 5 2h8.5Zm-6.3-8.5v-3h15.6v3Zm9.3 8.5v-3H34q2.9 0 5-2 2-2.1 2-5t-2-5q-2.1-2-5-2h-8.5v-3H34q4.2 0 7 3t3 7q0 4.2-3 7t-7 3Z"></path></svg></a></div><p>We looked at four different implementations and we could have gone on forever, as seldom are the patterns the same under the hood. I'm not saying it is important that a screen reader hears that it is an &quot;option&quot; because that implies that no change of context should automatically occur (without warning). Which begs the question, what should they hear if they access the suggestions? Well ultimately it's a link as it navigates to a new URL, but we cannot have links in a <code>listbox</code>, at least we cannot have their semantics exposed, we can of course add <code>role=&quot;option&quot;</code> to them, but as we discussed, we're still navigating by clicking an &quot;option&quot;, as although it is a link in HTML, we added ARIA which changes the role here.</p><p>Apple's are announced as links and it does inform a screen reader that there are a certain number of options available. It does not have <code>aria-controls</code> present on the <code>&lt;input&gt;,</code> which I know doesn't do a great deal due to lack of screen reader support, it does at least reinforce that programmatic relationship.</p><p>As it is critical that we consider all users when developing sites and the components they are built with, we need to ensure that they work for screen reader users too, then they are in the best position to decide whether they use it or not, user choice is the tool that allows users to operate sites in a way that works for them.</p><p>I guess you could have companies using the &quot;Alternate conforming version&quot; argument, in that they may claim the fallback is the search input, a user is not forced to use the suggestions. I'm not a WCAG purist, I hate that argument, it's typically used by teams that cannot be bothered to build something inclusive. You could of course counter that argument with &quot;It's not comparable, it takes significantly more keystrokes to only use the input, a user is burdened with having to be able to type their query identically, ensuring there are no spelling mistakes or typos etc&quot;</p><div class="cms__anchor-wrapper"><h2 id="how-should-we-build-one" tabindex="-1">How should we build one?</h2><a class="cms__anchor" href="#how-should-we-build-one" aria-labelledby="how-should-we-build-one"><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="4 14 40 20"><path d="M22.5 34H14q-4.2 0-7-3t-3-7q0-4.2 3-7t7-3h8.5v3H14q-2.9 0-5 2-2 2.1-2 5t2 5q2.1 2 5 2h8.5Zm-6.3-8.5v-3h15.6v3Zm9.3 8.5v-3H34q2.9 0 5-2 2-2.1 2-5t-2-5q-2.1-2-5-2h-8.5v-3H34q4.2 0 7 3t3 7q0 4.2-3 7t-7 3Z"></path></svg></a></div><p>I don't have a definitive answer here I'm afraid. If I had the resources available to me, I'd quite happily pay for some user testing, to test several patterns to determine which one seemed the most intuitive, especially to screen reader users. We can build a few patterns though and discuss some of the pros and cons of each, then if you're viewing this page to find a solution, you can hopefully conduct user testing and base your decision on that?</p><div class="cms__anchor-wrapper"><h2 id="lets-build-some-examples" tabindex="-1">Let's build some examples</h2><a class="cms__anchor" href="#lets-build-some-examples" aria-labelledby="lets-build-some-examples"><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="4 14 40 20"><path d="M22.5 34H14q-4.2 0-7-3t-3-7q0-4.2 3-7t7-3h8.5v3H14q-2.9 0-5 2-2 2.1-2 5t2 5q2.1 2 5 2h8.5Zm-6.3-8.5v-3h15.6v3Zm9.3 8.5v-3H34q2.9 0 5-2 2-2.1 2-5t-2-5q-2.1-2-5-2h-8.5v-3H34q4.2 0 7 3t3 7q0 4.2-3 7t-7 3Z"></path></svg></a></div><p>As always, this isn't a design demo, so I'm just going to make them look OK, I will of course ensure contrast and focus are perceivable, but they'll look relatively basic, just to reduce the amount of work I need to do. Also, there are some differences between the examples we discussed, most of them redirect a user to a search results page, whereas the Mozilla example directs a user to the actual page, we're going to be doing the latter.</p><p>We will only add the <code>listbox</code> or alternative roles when JS is available, I always build with progressive enhancement in mind, in that we don't want redundant controls on a page for our users if JS isn't available. What I'm going to do here is I'm going to write the base HTML for the input and its containers in actual HTML, obviously without JS this will do nothing at all. The two options here are:</p><ul><li>Add the input and wrapping elements to the DOM with JS instead, then a user won't have to face the frustration of interacting with a redundant control</li><li>Wrap the element in a<form>(assuming you have a backend for this) and have it direct to a Search Results page. When JS is available have, remove or neuter the form and have the component operate by clicking the links or matching the input text to an item in the suggestions container</form></li></ul><p>For the first example, I am going to provide all three files: HTML, JS &amp; CSS and only the JS for the remaining examples, as that's the only file that will change (He says apprehensively as thus far he has only built the first example).</p><h3>The combobox and option approach</h3><p>Technically this fails <a href="https://www.w3.org/WAI/WCAG22/Understanding/on-input.html">WCAG 3.2.2 On Input (A)</a>, similar to the Google approach, how much of an issue that actually is, is something that can only be determined by disabled folks, if they say it is perfectly understandable to them, irrespective of what WCAG says then users before standards, always. This view can of course be problematic for legal risk, depending where in the world you live, maybe the fact it does not fully comply could leave you open to some legal challenge.</p><p>What behaviour would a user expect from a site search? A sighted user would not &quot;see&quot; a typical <code>&lt;select&gt;</code> &amp;<code>&lt;option&gt;</code>s element, as the OS styles those, so what they &quot;see&quot; resembles something they encounter every time they use a search engine and most of the time they shop on large eCommerce sites, an <code>&lt;input&gt;</code> that will accept text input, whilst filtering a bunch of suggestions, clicking one of those suggestions will navigate to a results page or an actual page.</p><p>If the only user group that may find this behaviour unexpected are screen reader users, would it be enough to advise just those users of what will happen? I'm not a fan of hiding instructions just for screen reader users, typically all users benefit from them, in this instance though maybe it's acceptable, as we can make our suggestions look like links, we could use icons, underlines or whatever, just to add additional visual affordances. As none of those aforementioned affordances would provide a user of a screen reader with any additional information, could we just ensure that the name of the <code>&lt;input&gt;</code> includes a little extra info? If our <code>&lt;input&gt;</code> had a visually hidden accessible name, such as &quot;Search and filter navigation links&quot; and we had underlines on the actual links, is that enough of an advance warning to both sighted and unsighted users?</p><p>I could include a <code>&lt;button&gt;</code>, like a &quot;Go&quot; &lt;<code>button&gt;</code>, a user clicks a suggestion, focus returns to the input and there is an adjacent <code>&lt;button&gt;</code>, which when clicked will then perform the same action. This is an acceptable WCAG technique for meeting the On Input SC. But, sometimes it may be hard to convince stakeholders to add that <code>&lt;button&gt;</code>, as you may get the &quot;It's adding an extra step for everybody&quot; feedback, which is actually true. We may also get the &quot;We don't want a visible text <code>&lt;label&gt;</code> on the <code>&lt;input&gt;</code>, we just want an icon&quot; instruction. So, what I am going to do, is just create an <code>&lt;input&gt;</code>, with no button or visible label, it will just have a magnifying glass icon. Visually it has a label, as the icon communicates the purpose, programmatically, it will have a proper <code>&lt;label&gt;</code>, with the visually hidden text &quot;Search and filter navigation links&quot;. I have to admit to not being 100% sure whether in isolation the underlined links and the hidden label are enough to &quot;advise&quot; a user of expected behaviour to pass On Input, I think it is, but somebody smarter may disagree. See this as a &quot;grey area&quot;, until you can confirm otherwise.</p><h4>The HTML</h4><p>Nothing spectacular here, an <code>&lt;input&gt;</code> with an SVG and some wrapping <code>&lt;div&gt;</code> elements. we'll add the roles and properties with JS, as they're redundant without it, but as I said, this could be in a <code>&lt;form&gt;</code> for users without JS. The label for the input is just &quot;Search&quot; when JS isn't available, as no filtering can occur, so just keep this basic and swap it out when or if JS loads.</p><pre class="language-html"><code class="language-html"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header__search-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search__wrapper<span class="token punctuation">"</span></span> <span class="token attr-name">data-expanded</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sFilterLbl<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sFilter<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>visually-hidden<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Search<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search__input<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sFilter<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search__input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">aria-hidden</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">focusable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">stroke</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span> <span class="token attr-name">stroke-width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>9.8<span class="token punctuation">"</span></span> <span class="token attr-name">viewBox</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-19.6 -19.6 529.6 529.6<span class="token punctuation">"</span></span><br>      <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.25rem<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span><br>        <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>M484.1 454.8 373.6 344.2a210.6 210.6 0 1 0-29.2 29.2l110.5 110.5c12.9 11.8 25 4.2 29.2 0a20 20 0 0 0 0-29.1zm-443-244a169.5 169.5 0 1 1 339 0 169.5 169.5 0 0 1-339 0z<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Some static content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre><h4>The CSS</h4><p>Now, I'll just style it, I'm not going to explain any of this, I'll just summarise a few key points, after.</p><pre class="language-css"><code class="language-css"><span class="token selector">*,<br>*::after,<br>*::before</span> <span class="token punctuation">{</span><br>  <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span><br>  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">:root</span> <span class="token punctuation">{</span><br>  <span class="token property">--colour__primary</span><span class="token punctuation">:</span> rebeccapurple<span class="token punctuation">;</span><br>  <span class="token property">--colour__bg</span><span class="token punctuation">:</span> #fafafa<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">body</span> <span class="token punctuation">{</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><br>  <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span><br>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br>  <span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">,</span> Helvetica<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.header__search-container</span> <span class="token punctuation">{</span><br>  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><br>  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br>  <span class="token property">padding</span><span class="token punctuation">:</span> 24px 8px<span class="token punctuation">;</span><br>  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span><br>  <span class="token property">font-size</span><span class="token punctuation">:</span> 1.125rem<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.search__wrapper</span> <span class="token punctuation">{</span><br>  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span><br>  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span><br>  <span class="token property">max-width</span><span class="token punctuation">:</span> 25rem<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.search__wrapper svg</span> <span class="token punctuation">{</span><br>  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><br>  <span class="token property">right</span><span class="token punctuation">:</span> .5rem<span class="token punctuation">;</span><br>  <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span><br>  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>-50%<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--colour__primary<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">fill</span><span class="token punctuation">:</span> currentColor<span class="token punctuation">;</span><br>  <span class="token property">stroke</span><span class="token punctuation">:</span> currentColor<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.search__input</span> <span class="token punctuation">{</span><br>  <span class="token property">border</span><span class="token punctuation">:</span> 2px solid <span class="token function">var</span><span class="token punctuation">(</span>--colour__primary<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">border-radius</span><span class="token punctuation">:</span> 6px<span class="token punctuation">;</span><br>  <span class="token property">padding</span><span class="token punctuation">:</span> 8px 32px 8px 8px<span class="token punctuation">;</span><br>  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span><br>  <span class="token property">font-size</span><span class="token punctuation">:</span> 1.25rem<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.search__input:focus</span> <span class="token punctuation">{</span><br>  <span class="token property">outline</span><span class="token punctuation">:</span> 3px solid <span class="token function">var</span><span class="token punctuation">(</span>--colour__primary<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">outline-offset</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.search__panel-container</span> <span class="token punctuation">{</span><br>  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><br>  <span class="token property">bottom</span><span class="token punctuation">:</span> 22px<span class="token punctuation">;</span><br>  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>100%<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">border</span><span class="token punctuation">:</span> 2px solid <span class="token function">var</span><span class="token punctuation">(</span>--colour__primary<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">border-radius</span><span class="token punctuation">:</span> 0 0 4px 4px<span class="token punctuation">;</span><br>  <span class="token property">margin</span><span class="token punctuation">:</span> 0 4px<span class="token punctuation">;</span><br>  <span class="token property">padding-top</span><span class="token punctuation">:</span> 6px<span class="token punctuation">;</span><br>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 16px<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">max-width</span><span class="token punctuation">:</span> 25rem<span class="token punctuation">;</span><br>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--colour__bg<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.search__wrapper[data-expanded="false"]+.search__panel-container</span> <span class="token punctuation">{</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.search__panel</span> <span class="token punctuation">{</span><br>  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span><br>  <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span><br>  <span class="token property">max-height</span><span class="token punctuation">:</span> 60dvh<span class="token punctuation">;</span><br>  <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br>  <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.search__option</span> <span class="token punctuation">{</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span><br>  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span><br>  <span class="token property">padding</span><span class="token punctuation">:</span> 4px 6px<span class="token punctuation">;</span><br>  <span class="token property">line-height</span><span class="token punctuation">:</span> 1.5<span class="token punctuation">;</span><br>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--colour__primary<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.search__option[aria-selected="true"],<br>.search__option[data-selected="true"],<br>.search__option:hover</span> <span class="token punctuation">{</span><br>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--colour__primary<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--colour__bg<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">forced-colors</span><span class="token punctuation">:</span> active<span class="token punctuation">)</span></span> <span class="token punctuation">{</span><br><br>  <span class="token selector">.search__option[aria-selected="true"],<br>  .search__option[data-selected="true"]</span> <span class="token punctuation">{</span><br>    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--colour__primary<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token property">outline</span><span class="token punctuation">:</span> 3px solid <span class="token function">var</span><span class="token punctuation">(</span>--colour__primary<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token property">outline-offset</span><span class="token punctuation">:</span> -2px<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.search__message</span> <span class="token punctuation">{</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span><br>  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span><br>  <span class="token property">padding</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span><br>  <span class="token property">line-height</span><span class="token punctuation">:</span> 1.5<span class="token punctuation">;</span><br>  <span class="token property">color</span><span class="token punctuation">:</span> #bd0000<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.visually-hidden</span> <span class="token punctuation">{</span><br>  <span class="token property">clip</span><span class="token punctuation">:</span> <span class="token function">rect</span><span class="token punctuation">(</span>0 0 0 0<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">clip-path</span><span class="token punctuation">:</span> <span class="token function">inset</span><span class="token punctuation">(</span>50%<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">height</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span><br>  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span><br>  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><br>  <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span><br>  <span class="token property">width</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">/* ignore */</span><br><span class="token selector">a:not([class])</span> <span class="token punctuation">{</span><br>  <span class="token property">padding</span><span class="token punctuation">:</span> 1rem 0<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><ul><li>Normally I use <code>rem</code> units for <code>padding</code> and <code>margin</code>, I'm just experimenting with <code>px</code> units for this, as in this case there's little benefit making spacing bigger with page zoom</li><li>I add an <code>outline</code> with an <code>offset</code> to the <code>&lt;input&gt;</code> when it has focus, because let the people where they are and all that</li><li>I invert the colours of the background and text for the options, as typically you will see folks add a light grey background to the selected option and I can't see how that would pass <a href="https://www.w3.org/WAI/WCAG22/Understanding/use-of-color.html">1.4.1 Use of Colour</a></li><li>Our background won't show in High Contrast Mode, so I've added an outline to the selected option, so people can see where they are</li><li>I've hidden the actual label as I am being a sheep</li><li>I've made it look okay-ish and centred it etc</li></ul><h4>The JavaScript</h4><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> searchFilterWrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.header__search-container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ArrowUp'</span><span class="token punctuation">,</span> <span class="token string">'ArrowDown'</span><span class="token punctuation">,</span> <span class="token string">'Enter'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> searchWrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.search__wrapper'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> searchInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.search__input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> itemsArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> currItem<span class="token punctuation">;</span><br><span class="token keyword">const</span> links <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Home"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#a"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"About"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#b"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Contact"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#c"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Old Thing"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#d"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#e"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing Ultra"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#f"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing Ultra Pro"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#g"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing Ultra Pro Max"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#h"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing Ultra Pro Max Plus"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#i"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Shipping"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#j"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Privacy"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#k"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Cookies"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#l"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Accessibility? LOL"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#m"</span> <span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>searchFilterWrapper<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#sFilterLbl'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'Search and filter navigation links'</span><span class="token punctuation">;</span><br>searchFilterWrapper<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div class="search__panel-container">&lt;ul class="search__panel" id="lBox" role="listbox" aria-labelledby="sFilter">&lt;/ul><br>&lt;span aria-live="polite" class="search__message visually-hidden">&lt;/span>&lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>links<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">link<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  itemsArr <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>  &lt;li class="search__item" role="presentation" data-pos="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"><br>    &lt;a class="search__option" id="opt-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" role="option" tabindex="-1" href="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>link<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>link<span class="token punctuation">.</span>label<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/a><br>  &lt;/li></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">const</span> listbox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#lBox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> message <span class="token operator">=</span> searchFilterWrapper<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.search__message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>listbox<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> itemsArr<span class="token punctuation">)</span><span class="token punctuation">;</span><br>itemsArr <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'role'</span><span class="token punctuation">,</span> <span class="token string">'combobox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-activedescendant'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-autocomplete'</span><span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-expanded'</span><span class="token punctuation">,</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-controls'</span><span class="token punctuation">,</span> <span class="token string">'lBox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-expanded'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  searchWrapper<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-expanded'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'blur'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-expanded'</span><span class="token punctuation">,</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  searchWrapper<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-expanded'</span><span class="token punctuation">,</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">filterItems</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  itemsArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>searchInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      listbox<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>      item<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-selected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      item<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>  listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    item<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-pos'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> itemsArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    evt<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currItem <span class="token operator">&amp;&amp;</span> evt<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'ArrowDown'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">setSelected</span><span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[data-pos="1"]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>currItem <span class="token operator">&amp;&amp;</span> evt<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'ArrowDown'</span> <span class="token operator">&amp;&amp;</span> currItem<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">setSelected</span><span class="token punctuation">(</span>currItem<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>currItem <span class="token operator">&amp;&amp;</span> evt<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'ArrowUp'</span> <span class="token operator">&amp;&amp;</span> currItem<span class="token punctuation">.</span>previousElementSibling<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">setSelected</span><span class="token punctuation">(</span>currItem<span class="token punctuation">.</span>previousElementSibling<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>evt<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'Enter'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__option'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>searchInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> item<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> item<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-selected'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          item<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">filterItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-activedescendant'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    currItem <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>    <span class="token function">displayError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    message<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>    message<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>currItem<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">||</span><br>      <span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>listbox<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currItem<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">setSelected</span><span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[data-pos="1"]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">setSelected</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">listItem</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>listItem <span class="token operator">===</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      item<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-selected'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-activedescendant'</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      currItem <span class="token operator">=</span> item<span class="token punctuation">;</span><br>      item<span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">block</span><span class="token operator">:</span> <span class="token string">"nearest"</span><span class="token punctuation">,</span> <span class="token literal-property property">inline</span><span class="token operator">:</span> <span class="token string">"nearest"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>      listItem<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-selected'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'Safari'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'Chrome'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      message<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>      message<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>textContent<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, selected, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-pos'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>      message<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">displayError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  message<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'No matching results'</span><span class="token punctuation">;</span><br>  message<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><ul><li>So, I'm setting some global variables, particularly for the input, its wrapper, the container to pop the listbox in, the keys a user will press, an empty <code>itemsArr</code> array and an empty <code>currItem</code> variable</li><li>I change the accessible name, by replacing the label's text with &quot;Search and filter navigation links&quot;, which feels a bit yucky, but this is an example, not a recommendation</li><li>I'm just grabbing our <code>links</code> from an array of objects</li><li>I'm adding a further wrapper (We can't have an error message in a <code>listbox</code>), then I'm adding this message container as a sibling of the <code>listbox</code>, I'm mostly doing this as Safari doesn't support <code>aria-activedescendant</code>, yet, but also I want to inform a user that there are no matching suggestions, as that's useful to know, right?</li><li>I loop through our <code>links</code> creating a HTML string, with the necessary roles and properties, I add presentational list items as parents of the links, along with classes and IDs, adding them to our <code>itemsArr</code> array</li><li>I'm actually using links with a <code>role=&quot;option&quot;</code>, as there seems little point reinventing the wheel for navigating when links do exactly that out of the box</li><li>I declare some new variables that we created from strings as actual HTML elements that we need later</li><li>I add all of the roles and properties to the input</li><li>I expand the <code>listbox</code> on <code>focus</code> and close it on a <code>blur</code> event</li><li>I filter a user's typed string against the <code>textContent</code> of the links, if that string is present, keep it, else remove it from the DOM</li><li>We add a data attribute which takes the index (idx) and adds one, so it is not zero-based, we add this to the list item and update it when filtered, so irrespective of how many items are removed through filtering, the value of that attribute will always start at 1 and will increment for each subsequent item</li><li>I listen for key presses that match our array of keys, if it is arrow down and there is no selected option we pass the first link which will have the <code>data-pos=&quot;1&quot;</code> attribute and value set to a <code>setSelection()</code> function, else we just move to the next sibling if present and a hard stop if there isn't a next sibling</li><li>Similar to above, if a user is pressing up we send the previous sibling to the <code>setSelection()</code> function, else a hard stop</li><li>If a user presses <kbd>Enter</kbd> and the characters they input match the <code>textContent</code> of any link, we auto click that link and they navigate to that page</li><li>If the user has focussed on a link and presses <kbd>Enter</kbd>, we also complete that action automatically</li><li>If there are no matches, we reset our <code>currItem</code> variable to empty, set <code>aria-activedescendant</code>to empty and call the <code>displayError()</code> function</li><li>We manage which item to focus on, in the options if there is at least one option, this could be improved, as if the currently focused item is removed from the DOM after typing, I'm just pushing focus back to the first item, when it would be nicer to place it on the next sibling if it exists</li><li>When an item is the &quot;focused&quot; item, we set <code>aria-selected=&quot;true&quot;</code> and update the value of <code>aria-activedescendant</code>, along with our <code>currItem</code> variable</li><li>We ensure that the user can actually see which item they have arrowed to, using <code>scrollIntoView()</code>and we remove <code>aria-selected</code> from any item that isn't the currently selected item</li><li>We shoehorn a fix in for Safari, as it doesn't support <code>aria-activedescendant</code>, so we check for that user agent, then we build a string that will announce &quot;[Item name], selected, [position of item] of [number of items in set]&quot;, this matched exactly what I heard from VoiceOver output on Safari with an alternative, so I have provided identical information</li><li>I finally have a error message which will be visible to users and heard by screen reader users &quot;No matching results&quot; and this only appears should a user type something that doesn't match an item in the list</li></ul><p>So, that wraps up the first example, which uses the standard combobox pattern, albeit for navigation as opposed to selecting something. Unlike MDN's at least we haven't added a link inside the option, we just used a link so we got its behaviour and applied <code>role=&quot;option&quot;</code>to use the correct ARIA pattern. I am aware of the second rule of ARIA but this seemed a better approach than adding a link with role=&quot;presentation&quot; and then adding a <code>&lt;span role=&quot;option&quot;&gt;</code> inside of that link</p><p>Whether this is better than any of the examples we looked at for users is not something I can answer, but it is an approach worth considering, maybe you or your team could improve it further?</p><p>Here's a CodePen to test and tinker with:</p><p class="codepen" data-height="300" data-theme-id="dark" data-default-tab="js,result" data-slug-hash="LYaZwro" data-user="LDAWG-a11y" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"><span>See the Pen <a href="https://codepen.io/LDAWG-a11y/pen/LYaZwro">ARIA 1.2 combobox for links (experimental)</a> by LDAWG-a11y (<a href="https://codepen.io/LDAWG-a11y">@LDAWG-a11y</a>) on <a href="https://codepen.io">CodePen</a>.</span></p><script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script><h3>The combobox and dialog approach</h3><p>I haven't seen this pattern used out in the wild, it was an untested suggestion by a member of the A11y Slack community and it makes a lot of sense. A <code>combobox</code> can be associated with an element that either has the role of <code>listbox</code>, <code>tree</code>, <code>grid</code> or <code>dialog</code>. We have already used <code>listbox</code>, we don't need <code>grid</code> or <code>tree</code>, but the beauty of using <code>dialog</code> is that it doesn't have any constraints over what we place inside it. Our links can actually be links without overwriting the <code>role</code>. I'm just going to try and get away with using our existing HTML and CSS, which I'm only doing for simplicity's sake and to keep this guide a bit shorter. So, just the JS changes a little here, I'll outline what I changed from the initial implementation:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> searchFilterWrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.header__search-container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ArrowUp'</span><span class="token punctuation">,</span> <span class="token string">'ArrowDown'</span><span class="token punctuation">,</span> <span class="token string">'Enter'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> searchWrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.search__wrapper'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> searchInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.search__input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> itemsArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> currItem<span class="token punctuation">;</span><br><span class="token keyword">const</span> links <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Home"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#a"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"About"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#b"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Contact"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#c"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Old Thing"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#d"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#e"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing Ultra"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#f"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing Ultra Pro"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#g"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing Ultra Pro Max"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#h"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing Ultra Pro Max Plus"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#i"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Shipping"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#j"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Privacy"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#k"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Cookies"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#l"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Accessibility? LOL"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#m"</span> <span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>searchFilterWrapper<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#sFilterLbl'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'Search and filter navigation links'</span><span class="token punctuation">;</span><br>searchFilterWrapper<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div class="search__panel-container" role="dialog" aria-labelledby="sFilter">&lt;ul class="search__panel" id="lBox">&lt;/ul><br>&lt;span aria-live="polite" class="search__message visually-hidden">&lt;/span>&lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>links<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">link<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  itemsArr <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>  &lt;li class="search__item" data-pos="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"><br>    &lt;a class="search__option" id="opt-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" tabindex="-1" href="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>link<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>link<span class="token punctuation">.</span>label<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/a><br>  &lt;/li></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">const</span> listbox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#lBox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> message <span class="token operator">=</span> searchFilterWrapper<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.search__message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>listbox<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> itemsArr<span class="token punctuation">)</span><span class="token punctuation">;</span><br>itemsArr <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'role'</span><span class="token punctuation">,</span> <span class="token string">'combobox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-activedescendant'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-autocomplete'</span><span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-expanded'</span><span class="token punctuation">,</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-controls'</span><span class="token punctuation">,</span> <span class="token string">'lBox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-expanded'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  searchWrapper<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-expanded'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'blur'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-expanded'</span><span class="token punctuation">,</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  searchWrapper<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-expanded'</span><span class="token punctuation">,</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">filterItems</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  itemsArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>searchInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      listbox<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>      item<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'data-selected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      item<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>  listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    item<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-pos'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> itemsArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    evt<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currItem <span class="token operator">&amp;&amp;</span> evt<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'ArrowDown'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">setSelected</span><span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[data-pos="1"]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>currItem <span class="token operator">&amp;&amp;</span> evt<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'ArrowDown'</span> <span class="token operator">&amp;&amp;</span> currItem<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">setSelected</span><span class="token punctuation">(</span>currItem<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>currItem <span class="token operator">&amp;&amp;</span> evt<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'ArrowUp'</span> <span class="token operator">&amp;&amp;</span> currItem<span class="token punctuation">.</span>previousElementSibling<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">setSelected</span><span class="token punctuation">(</span>currItem<span class="token punctuation">.</span>previousElementSibling<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>evt<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'Enter'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__option'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>searchInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> item<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> item<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token string">'data-selected'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          item<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">filterItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-activedescendant'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    currItem <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>    <span class="token function">displayError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    message<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>    message<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>currItem<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">||</span><br>      <span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>listbox<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currItem<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">setSelected</span><span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[data-pos="1"]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">setSelected</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">listItem</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>listItem <span class="token operator">===</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      item<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-selected'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-activedescendant'</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      currItem <span class="token operator">=</span> item<span class="token punctuation">;</span><br>      item<span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">block</span><span class="token operator">:</span> <span class="token string">"nearest"</span><span class="token punctuation">,</span> <span class="token literal-property property">inline</span><span class="token operator">:</span> <span class="token string">"nearest"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>      listItem<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'data-selected'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'Safari'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'Chrome'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      message<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>      message<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>textContent<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-pos'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>      message<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">displayError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  message<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'No matching results'</span><span class="token punctuation">;</span><br>  message<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><ul><li>I removed the combobox role and associated properties from the<ul>and added role=&quot;dialog&quot; and <code>aria-labelledby=&quot;sFilter&quot;</code> to the parent container <code>.search__panel-container</code></ul></li><li>I removed the presentation role from the list items, our list is now exposed as a list</li><li>I removed <code>role=&quot;option&quot;</code> from the links, so now they are exposed as actual links</li><li>All references to <code>aria-selected</code> have been replaced with a data attribute, <code>data-selected</code> as we cannot have <code>aria-selected</code> on elements with a link role and as we are using &quot;pretend focus&quot; for the suggestions, we needed a class or attribute to hook on to, to add a focus indicator</li><li>In our shoe-horned Safari fix, I removed the word &quot;selected&quot; from the generated string for the announcement, as that would be odd hearing a link is selected</li></ul><p>That was pretty easy going, not a great deal changed there. As I said, this is not something I have personally encountered, but it was recommended as something to explore by somebody more experienced than me, so I thought its inclusion was worthwhile.</p><p>We no longer need to concern ourselves with the On Input issue on the previous implementation as we are not navigating with role=&quot;option&quot; elements, they are actual links. Of course, there is a slight issue in that they cannot be tabbed to, but this is a combobox, which has a purpose of allowing a user to mix up typing and arrowing up or down, without &quot;true focus&quot; ever leaving the input and of course, we definitely do not want this in place of a well structured, accessible site nav, but if used in combination with a good navigation, it could certainly help users find nested pages, such as products, guides, courses or whatever.</p><p>Please do test with users before following this approach, I can't see why it would be too different than the previous pattern, given the announcement of roles and properties are the same, but actual users are the ones that can give you far better data than me.</p><p>Here's the CodePen:</p><p class="codepen" data-height="300" data-theme-id="dark" data-default-tab="js,result" data-slug-hash="JjzKgmV" data-user="LDAWG-a11y" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"><span>See the Pen <a href="https://codepen.io/LDAWG-a11y/pen/JjzKgmV">ARIA 1.2 combobox for links with dialog (experimental)</a> by LDAWG-a11y (<a href="https://codepen.io/LDAWG-a11y">@LDAWG-a11y</a>) on <a href="https://codepen.io">CodePen</a>.</span></p><script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script><h3>The non-combobox approach</h3><p>This is more like the Apple example we discussed earlier, with a couple of minor tweaks. This particular approach doesn't convince me it's as conventional of a pattern as the previous two approaches. The issue I see here, is the lack of roles on the input. A screen reader user would take cues from those roles in that they indicate a certain interaction model (at least it should if coded correctly), without these roles, would a screen reader know arrow key navigation is available? The Apple implementation does also allow tabbing to the suggestions, but if the input loses focus and our user has to reverse <kbd>Tab</kbd> back to it when they discover their suggestion is not in the list, then this seems a bit clunky and less than ideal. I'm not a screen reader user, so this is just my &quot;best guess&quot; take on it, but I base that best guess on what seems the glaringly obvious reason the combobox pattern exists, to be able to type, have a little search in the suggestions, then being able to type some more without having to <kbd>Tab</kbd> back up into the input to be able to continue typing/filtering? It would certainly be beneficial to explore this pattern with screen reader users, along with the others.</p><p>Again, as I'm a little lazy, I'm just gonna modify the code from before, so just the JS is changing again:</p><pre class="language-javascript"><code class="language-javascript"> <span class="token keyword">const</span> searchFilterWrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.header__search-container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ArrowUp'</span><span class="token punctuation">,</span> <span class="token string">'ArrowDown'</span><span class="token punctuation">,</span> <span class="token string">'Enter'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> searchWrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.search__wrapper'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> searchInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.search__input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> itemsArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> currItem<span class="token punctuation">;</span><br><span class="token keyword">const</span> links <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Home"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#a"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"About"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#b"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Contact"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#c"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Old Thing"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#d"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#e"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing Ultra"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#f"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing Ultra Pro"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#g"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing Ultra Pro Max"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#h"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"New Thing Ultra Pro Max Plus"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#i"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Shipping"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#j"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Privacy"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#k"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Cookies"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#l"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Accessibility? LOL"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"#m"</span> <span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>searchFilterWrapper<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#sFilterLbl'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'Search and filter navigation links, suggestions below'</span><span class="token punctuation">;</span><br>searchFilterWrapper<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div class="search__panel-container" role="region" aria-labelledby="sFilter">&lt;ul class="search__panel" id="lBox">&lt;/ul><br>&lt;span aria-live="polite" class="search__message visually-hidden">&lt;/span>&lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>links<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">link<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  itemsArr <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>  &lt;li class="search__item" data-pos="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"><br>    &lt;a class="search__option" id="opt-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" tabindex="-1" href="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>link<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>link<span class="token punctuation">.</span>label<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/a><br>  &lt;/li></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">const</span> listbox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#lBox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> message <span class="token operator">=</span> searchFilterWrapper<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.search__message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>listbox<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> itemsArr<span class="token punctuation">)</span><span class="token punctuation">;</span><br>itemsArr <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-controls'</span><span class="token punctuation">,</span> <span class="token string">'lBox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  searchWrapper<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-expanded'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'blur'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  searchWrapper<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-expanded'</span><span class="token punctuation">,</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">filterItems</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  itemsArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>searchInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      listbox<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>      item<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'data-selected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      item<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>  listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    item<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-pos'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> itemsArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    evt<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currItem <span class="token operator">&amp;&amp;</span> evt<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'ArrowDown'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">setSelected</span><span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[data-pos="1"]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>currItem <span class="token operator">&amp;&amp;</span> evt<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'ArrowDown'</span> <span class="token operator">&amp;&amp;</span> currItem<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">setSelected</span><span class="token punctuation">(</span>currItem<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>currItem <span class="token operator">&amp;&amp;</span> evt<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'ArrowUp'</span> <span class="token operator">&amp;&amp;</span> currItem<span class="token punctuation">.</span>previousElementSibling<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">setSelected</span><span class="token punctuation">(</span>currItem<span class="token punctuation">.</span>previousElementSibling<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>evt<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'Enter'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__option'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>searchInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> item<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> item<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token string">'data-selected'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          item<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>searchInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">filterItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    currItem <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>    <span class="token function">displayError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    message<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>    message<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>currItem<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">||</span><br>      <span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>listbox<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currItem<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">setSelected</span><span class="token punctuation">(</span>listbox<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[data-pos="1"]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">setSelected</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.search__item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">listItem</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>listItem <span class="token operator">===</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      item<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-selected'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      currItem <span class="token operator">=</span> item<span class="token punctuation">;</span><br>      item<span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">block</span><span class="token operator">:</span> <span class="token string">"nearest"</span><span class="token punctuation">,</span> <span class="token literal-property property">inline</span><span class="token operator">:</span> <span class="token string">"nearest"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>      listItem<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'data-selected'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    message<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>    message<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>textContent<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-pos'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>listbox<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>    message<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">displayError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  message<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'No matching results'</span><span class="token punctuation">;</span><br>  message<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><ul><li>I removed the <code>combobox</code> role</li><li>I removed all references to <code>aria-activedescendant</code>, <code>aria-autocomplete</code> and <code>aria-expanded</code> as none of those are supported on a standard input</li><li>I removed the <code>dialog</code>/<code>listbox</code> role from the list container, replacing it with <code>role=&quot;region&quot;</code> and kept the accessible name</li><li>Where we previously had our Safari fix, I now provide this for every user agent, as without <code>aria-activedescendant</code>, nothing is announced on any browser/screen reader pairing</li><li>I appended the label with &quot;suggestions below&quot;, which feels wrong, but this is just an example, not a recommendation</li></ul><p>Here's the CodePen:</p><p class="codepen" data-height="300" data-theme-id="dark" data-default-tab="js,result" data-slug-hash="YzgWmgX" data-user="LDAWG-a11y" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"><span>See the Pen <a href="https://codepen.io/LDAWG-a11y/pen/YzgWmgX">Search filter for nav links no combobox role (experimental)</a> by LDAWG-a11y (<a href="https://codepen.io/LDAWG-a11y">@LDAWG-a11y</a>) on <a href="https://codepen.io">CodePen</a>.</span></p><script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script><h3>Potential considerations and improvements</h3><p>Don't just go copying me and hoping it works in all scenarios, there are a few of things you may need to consider:</p><ul><li>As my search is at the top of the page and the page has hardly any content, I don't need to worry about it being in view when focussed, maybe you do? Ensure that wherever it is situated, when it receives focus it is visible and so is enough of the suggestions box, perhaps scrolling it to the top of the screen upon it receiving focus will ensure at least some suggestions are in view</li><li>Think about the virtual keyboard, as we have an input some users user are going to trigger the on screen keyboard which will at times obscure the &quot;focussed&quot; item. Whilst we cannot and should not do anything about the keyboard, we at least need to make sure there is enough of the suggestions visible to allow a user to decide whether they want to manually close the virtual keyboard, testing this on an iPhone 5 or similar should give you a good idea, as that is a really small phone, compared to today's behemoths. I guess we could get creative and increase the padding dramatically so the &quot;pretend focus&quot; item is always situated at the top of the suggestions dialog, we could also use inline autocomplete, as the current &quot;pretend focus&quot; item's text would appear in the input, so that removes may be helpful</li><li>We could add <code>aria-current=&quot;true&quot;</code> to an item that matches the current page URL, but we can only do this for the <code>role=&quot;dialog&quot;</code> and the non-combobox approaches, as we can't add it to a <code>role=&quot;option&quot;</code> element</li><li>If we had a site with 1000s of products, how do we consider list length? We're not going to put a couple of thousand items in there, are we? So, what should the maximum limit of items in the panel be, should we cap it at 20, 30, 50, more? Too few and we run the risk of having a blind user thinking &quot;Oh, there's only 10 things in there, I'll use that&quot; and they find the thing they wanted is not present and they still need to input enough text to filter the thing they want into the list</li><li>Is there a too many? What are the effects of having a large number of items, does it put users off, make it difficult, increase the cognitive load? I have seen patterns where it may show 20 or so items, then the last item is a &quot;Load more&quot; item, obviously we'd need to manage focus for this functionality and also what would the role of that item be? It should be a button in most cases, but button's can't be present inside a <code>listbox</code>, we could do it for the other two examples, with a bit of logic and creativity, I guess</li><li>How do we handle empty queries, typos, search terms that don't match our array? We don't want to assume our users know exactly what to type to filter down the suggestions, many orgs have a &quot;Contact us&quot; page, some have a &quot;Get in touch&quot; page instead, if our users type &quot;Cont&quot; hoping to filter enough to show &quot;Contact us&quot; and we're breaking from convention to seem really &quot;hip&quot;, by calling that page &quot;get in touch&quot;, then they're not gonna find what they are looking for. Given my view on progressive enhancement, I recommended having a Search page for when JS is not available, it would likely be a good fallback to use that when a user types something that does not match an existing item from the suggestions list, that's backend stuff though and that is on you</li></ul><p>So, there are still a few considerations to discuss and figure out, but most importantly, get some disabled users on board, pay them for their time and conduct some testing. Perhaps at first do not mention the suggestions exist, just see if they find them and use them of their own accord, then for the next test, ask them to use them along with typing part of a string. Take their advice on board and use the pattern that best serves them and make any enhancements they suggest.</p><p>Functionally, all of the 3 examples are identical, they all operate in the same way, the differences are with what is announced to a screen reader user, as the roles and properties differ and it is typically only a screen reader user that will be provided with those cues.</p><div class="cms__anchor-wrapper"><h2 id="wrapping-up" tabindex="-1">Wrapping up</h2><a class="cms__anchor" href="#wrapping-up" aria-labelledby="wrapping-up"><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="4 14 40 20"><path d="M22.5 34H14q-4.2 0-7-3t-3-7q0-4.2 3-7t7-3h8.5v3H14q-2.9 0-5 2-2 2.1-2 5t2 5q2.1 2 5 2h8.5Zm-6.3-8.5v-3h15.6v3Zm9.3 8.5v-3H34q2.9 0 5-2 2-2.1 2-5t-2-5q-2.1-2-5-2h-8.5v-3H34q4.2 0 7 3t3 7q0 4.2-3 7t-7 3Z"></path></svg></a></div><p>Looking at the three examples using what I know of ARIA and HTML I'm inclined to assume the third example will be the most difficult to understand for a user that cannot see the component, as most of the auditory information that is provided in the previous two examples is stripped out. I even had to remove <code>aria-expanded</code>, as it is not supported on on an input without a <code>role=&quot;combobox&quot;</code>. I did have to append the accessible name of the input to provide our users with an idea that there are suggestions below.</p><p>The first example may well be entirely usable and understandable, it does of course come with the On input Issue, how much of an issue that actually is would depend on various factors, firstly how usable it is to users of with various disabilities and then legislation, internal policies or whatever else.</p><p>The second example does remove the non-compliance risk, as we're using actual links to navigate, as opposed to options. Does the using of a <code>dialog</code> as opposed to a <code>listbox</code> affect a user's understanding of the component? I tentatively say I don't <strong>think</strong> it would, but I'm basing that on what I heard with the screen readers I used and none of them output either &quot;dialog&quot; or &quot;listbox&quot;, but I haven't changed any settings on my screen readers, I don't have JAWS and everything I do have is up to date; software wise so I haven't tested on older versions or anything. Remember, this is more of a discussion, than a recommendation.</p></article><div class="socials__container" role="group" aria-labelledby="shareTitle"><h2 class="socials__title" id="shareTitle" data-no-accent>Share on:</h2><a href="//twitter.com/intent/tweet?text=Accessible%20site%20search%20with%20combobox%20suggestions&url=https://www.makethingsaccessible.com/guides/accessible-site-search-with-combobox-suggestions/" class="socials__link"><span class="visually-hidden">Twitter</span> include '../svg/twitter.svg' %}</a> <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.makethingsaccessible.com/guides/accessible-site-search-with-combobox-suggestions/&title=Accessible%20site%20search%20with%20combobox%20suggestions" class="socials__link"><span class="visually-hidden">LinkedIn</span><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M1 2.84A1.84 1.84 0 0 1 2.84 1h18.32A1.84 1.84 0 0 1 23 2.84v18.32A1.84 1.84 0 0 1 21.16 23H2.84A1.84 1.84 0 0 1 1 21.16V2.84Zm8.7 6.55h2.99v1.5c.43-.87 1.53-1.64 3.18-1.64 3.17 0 3.92 1.71 3.92 4.86v5.82h-3.2v-5.1c0-1.8-.44-2.8-1.53-2.8-1.51 0-2.14 1.08-2.14 2.8v5.1H9.7V9.39Zm-5.5 10.4h3.22V9.25H4.2v10.54ZM7.88 5.81a2.06 2.06 0 1 1-4.12 0 2.06 2.06 0 0 1 4.13 0Z" clip-rule="evenodd"/></svg></a></div><aside class="author-bio"><h2 class="author-bio__title">About Darren</h2><div class="author-bio__intro"><p>Darren is both a digital accessibility analyst and a frontend web developer who focuses on building accessible, performant and intuitive websites. Darren is the developer for this platform and he built it with an accessibility-first approach, applying all of his knowledge of accessible web interfaces through each stage of the project.</p></div><dl class="author-bio__meta"><div class="author-bio__items-wrapper"><dt class="author-bio__term">Position:</dt><dd class="author-bio__description">Digital Accessibility Analyst</dd></div><div class="author-bio__items-wrapper"><dt class="author-bio__term">Organisation:</dt><dd class="author-bio__description">University of Westminster</dd></div><div class="author-bio__items-wrapper"><dt class="author-bio__term"><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"><path fill="currentColor" d="M22.46 6c-.77.35-1.6.58-2.46.69a4.3 4.3 0 0 0 1.88-2.38c-.83.5-1.75.85-2.72 1.05a4.28 4.28 0 0 0-7.32 3.91A12.2 12.2 0 0 1 3 4.79a4.24 4.24 0 0 0 1.33 5.71c-.71 0-1.37-.2-1.95-.5v.03a4.3 4.3 0 0 0 3.44 4.21 4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.52 8.52 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06A12.14 12.14 0 0 0 8.12 21C16 21 20.33 14.46 20.33 8.79l-.01-.56A8.57 8.57 0 0 0 22.46 6Z"/></svg></dt><dd class="author-bio__description"><a href="https://twitter.com/daz079" class="author-bio__link">@daz079</a></dd></div><div class="author-bio__items-wrapper"><dt class="author-bio__term"><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M1 2.84A1.84 1.84 0 0 1 2.84 1h18.32A1.84 1.84 0 0 1 23 2.84v18.32A1.84 1.84 0 0 1 21.16 23H2.84A1.84 1.84 0 0 1 1 21.16V2.84Zm8.7 6.55h2.99v1.5c.43-.87 1.53-1.64 3.18-1.64 3.17 0 3.92 1.71 3.92 4.86v5.82h-3.2v-5.1c0-1.8-.44-2.8-1.53-2.8-1.51 0-2.14 1.08-2.14 2.8v5.1H9.7V9.39Zm-5.5 10.4h3.22V9.25H4.2v10.54ZM7.88 5.81a2.06 2.06 0 1 1-4.12 0 2.06 2.06 0 0 1 4.13 0Z" clip-rule="evenodd"/></svg></dt><dd class="author-bio__description"><a href="https://www.linkedin.com/in/darren-lee-224334147" class="author-bio__link">/in/darren-lee-224334147</a></dd></div></dl></aside></main><footer class="footer"><div class="footer__contact-us"><h2 data-no-accent>Contact us</h2><div><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"><path fill="currentColor" d="M22.46 6c-.77.35-1.6.58-2.46.69a4.3 4.3 0 0 0 1.88-2.38c-.83.5-1.75.85-2.72 1.05a4.28 4.28 0 0 0-7.32 3.91A12.2 12.2 0 0 1 3 4.79a4.24 4.24 0 0 0 1.33 5.71c-.71 0-1.37-.2-1.95-.5v.03a4.3 4.3 0 0 0 3.44 4.21 4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.52 8.52 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06A12.14 12.14 0 0 0 8.12 21C16 21 20.33 14.46 20.33 8.79l-.01-.56A8.57 8.57 0 0 0 22.46 6Z"/></svg> <a class="footer__link" href="https://twitter.com/MTAccessible?s=20&t=x69yq8wMBQ4y5j6byafhyw" class="">Find us on Twitter</a></div><div><svg focusable="false" aria-hidden="true" width="24px" height="24px" viewBox="0 0 24 24"><path fill="currentColor" d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Z"/></svg> <span class="visually-hidden">Email: </span><a class="footer__link" href="mailto:info@makethingsaccessible.com">info@makethingsaccessible.com</a></div></div><div class="footer__help"><h2 data-no-accent>Need help?</h2><p class="footer__help-text">If you have trouble with accessing any part of our site or links, please let us know and one of our experienced team will identify and resolve the problem. If any part of the site does not work as intended with your assistive technology, please provide details of the browser, assistive technology you're using, and the URL wherever possible.</p></div><div class="footer__mta-links"><h2 data-no-accent>Make Things Accessible links</h2><ul class="footer__list"><li class="footer__list-item"><a class="footer__link" href="/">Home</a></li><li class="footer__list-item"><a class="footer__link" href="/about/">About</a></li><li class="footer__list-item"><a class="footer__link" href="/guides/">Guides</a></li><li class="footer__list-item"><a class="footer__link" href="/faqs/">FAQs</a></li><li class="footer__list-item"><a class="footer__link" href="/accessibility/">Accessibility</a></li><li class="footer__list-item"><a class="footer__link" href="/glossary/">Glossary</a></li><li class="footer__list-item"><a class="footer__link" href="/privacy/">Privacy Policy</a></li><li class="footer__list-item"><a class="footer__link" href="/sitemapNav/">Sitemap</a></li><li class="footer__list-item"><a class="footer__link" href="/codeOfConduct">Code of Conduct</a></li><li class="footer__list-item"><a class="footer__link" href="/contributing">Contributing</a></li><li class="footer__list-item"><a class="footer__link" href="/admin">Admin</a></li></ul></div><div class="footer__collabs"><h2 data-no-accent>Access and Assistance for All</h2><ul class="footer__list--collabs"><li class="footer__list-item"><a class="footer__link" href="/aaa/">AAA Home</a></li><li class="footer__list-item"><a class="footer__link" href="/aaa/roles/">AAA Roles</a></li><li class="footer__list-item"><a class="footer__link" href="/aaa/student-stories/">AAA Student Stories</a></li><li class="footer__list-item"><a class="footer__link" href="/aaa/supporters/">AAA Supporters</a></li></ul></div><div class="footer__colophon"><p>&copy; 2024 Make Things Accessible - powered by <a class="footer__link" href="https://www.netlify.com/">Netlify</a> & <a class="footer__link" href="https://www.11ty.dev/">11ty</a></p></div></footer><dialog class="dialog" id="settingsModal"><header class="dialog__header"><h1 class="dialog__title" tabindex="-1" autofocus>Site preferences</h1></header><div class="dialog__content"><p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Iusto maiores magni veritatis eligendi! Labore accusamus magnam aspernatur totam, inventore nisi!</p><p>Excepturi officia rerum, quae totam debitis aliquid delectus perspiciatis laudantium mollitia temporibus corrupti optio odit in veniam exercitationem maiores hic!</p><p>Cumque natus, id distinctio, deserunt odit facere, aliquid quae veniam quo adipisci alias corrupti fugiat dicta ratione itaque delectus rerum!</p><h2 class="dialog__subtitle">Colour scheme</h2><fieldset class="settings__fieldset"><legend class="settings__legend">Theme</legend><h3 class="accordion">Themes help</h3><div class="accordion__panel"><div><ul><li>Light: will typically be darker text on lighter backgrounds (with limited exceptions), all contrast for text and non-text items meets or surpasses relevant success criteria for WCAG 2.2 at Level AAA (the highest level)</li><li>Default (Unset): will obey your device settings, if no setting is detected, it will default to the light theme</li><li>Dark: this option is darker backgrounds with lighter text and also surpasses WCAG 2.2 requirements at Level AAA</li></ul></div></div><div class="settings__btns-wrapper"><button class="settings__btn--theme-light" aria-pressed="false" data-pref="theme light"><span>Light</span></button> <button class="settings__btn--theme-unset" aria-pressed="false" data-pref="theme unset"><span>Unset</span></button> <button class="settings__btn--theme-dark" aria-pressed="false" data-pref="theme dark"><span>Dark</span></button></div></fieldset><h2 class="dialog__subtitle">Motion</h2><fieldset class="settings__fieldset"><legend class="settings__legend">Motion & animation</legend><h3 class="accordion">Motion & animation help</h3><div class="accordion__panel"><div><ul><li>Default (Unset): is obeying user device settings. If no preference is set, fade transtitions, micros animations such as rotating icons (when clicking buttons that expand ne content), smooth scrolling and expandingand collapsing animations are present. If a user has set reduce motion, smooth scrolling as well as expanding and collapsing animations will not be present, fading transtitions and micro animations are still present.</li><li>None: All animations set by us are completely removed, including fade transitions.</li></ul></div></div><div class="settings__btns-wrapper"><button class="settings__btn--motion-unset" aria-pressed="false" data-pref="motion unset"><span>Unset</span></button> <button class="settings__btn--motion-none" aria-pressed="false" data-pref="motion none"><span>None</span></button></div></fieldset><h2 class="dialog__subtitle">Links</h2><fieldset class="settings__fieldset"><legend class="settings__legend">Underline all links</legend><h3 class="accordion">Underline all links help</h3><div class="accordion__panel"><div><ul><li>Default (Unset): has underlines on most links, exceptions are the top level links in the main navigation (on desktop), cards, tags and image or icon links.</li><li>Yes: will add underlines to the exceptions outlined above, resulting in every link being underlined</li></ul></div></div><div class="settings__btns-wrapper"><button class="settings__btn--underline-unset" aria-pressed="false" data-pref="underline unset"><span>Unset</span></button> <button class="settings__btn--underline-yes" aria-pressed="false" data-pref="underline yes"><span>Yes</span></button></div></fieldset><h2 class="dialog__subtitle">Text and paragraphs</h2><fieldset class="settings__fieldset"><legend class="settings__legend">Font size (main content)</legend><h3 class="accordion">Font size help</h3><div class="accordion__panel"><div><p>This setting does not apply to the site's header or footer regions</p><ul><li>Default (Unset): Font sizes are set to site defaults</li><li>Large: The main text will appear <span class="large-text">This size</span></li><li>Largest: The main text will appear <span class="largest-text">This size</span></li></ul></div></div><div class="settings__btns-wrapper"><button class="settings__btn--f-size-large" aria-pressed="false" data-pref="f-size large"><span>Large</span></button> <button class="settings__btn--f-size-unset" aria-pressed="false" data-pref="f-size unset"><span>Unset</span></button> <button class="settings__btn--f-size-largest" aria-pressed="false" data-pref="f-size largest"><span>Largest</span></button></div></fieldset><fieldset class="settings__fieldset"><legend class="settings__legend">Letter spacing</legend><h3 class="accordion">Letter spacing help</h3><div class="accordion__panel"><div><ul><li>Default (Unset): has no modifications to letter spacing present</li><li>Increased: Multiplies the font size by 0.12 and adds the sum as spacing between each character</li></ul></div></div><div class="settings__btns-wrapper"><button class="settings__btn--l-spacing-unset" aria-pressed="false" data-pref="l-spacing unset"><span>Unset</span></button> <button class="settings__btn--l-spacing-increased" aria-pressed="false" data-pref="l-spacing increased"><span>Increased</span></button></div></fieldset><fieldset class="settings__fieldset"><legend class="settings__legend">Line height</legend><h3 class="accordion">Line height help</h3><div class="accordion__panel"><div><ul><li>Default (Unset): all text has a minimum line height of 1.5 times the size of the text</li><li>Increased all text has a line height of twice the size of the text</li></ul></div></div><div class="settings__btns-wrapper"><button class="settings__btn--l-height-unset" aria-pressed="false" data-pref="l-height unset"><span>Unset</span></button> <button class="settings__btn--l-height-increased" aria-pressed="false" data-pref="l-height increased"><span>Increased</span></button></div></fieldset><fieldset class="settings__fieldset"><legend class="settings__legend">Paragraph spacing</legend><h3 class="accordion">Paragraph spacing help</h3><div class="accordion__panel"><div><summary>Paragraph spacing help</summary><ul><li>Default (Unset): The space between paragraphs is equivalent to 1.5 times the height of the paragraph's text</li><li>Increased: The space between paragraphs is equivalent to 2.25 times the height of the paragraph's text</li></ul></div></div><div class="settings__btns-wrapper"><button class="settings__btn--p-spacing-unset" aria-pressed="false" data-pref="p-spacing unset"><span>Unset</span></button> <button class="settings__btn--p-spacing-increased" aria-pressed="false" data-pref="p-spacing increased"><span>Increased</span></button></div></fieldset><fieldset class="settings__fieldset"><legend class="settings__legend">Word spacing preference</legend><h3 class="accordion">Word spacing help</h3><div class="accordion__panel"><div><ul><li>Default (Unset): No modifications to word spacing are present</li><li>Increased: Spaces between words are equivalent to 0.16 times the font size</li></ul></div></div><div class="settings__btns-wrapper"><button class="settings__btn--w-spacing-unset" aria-pressed="false" data-pref="w-spacing unset"><span>Unset</span></button> <button class="settings__btn--w-spacing-increased" aria-pressed="false" data-pref="w-spacing increased"><span>Increased</span></button></div></fieldset></div><footer class="dialog__footer"><button class="dialog__close-btn" id="modalCloseBtn"><span>Close</span></button></footer></dialog><script src="/js/main.js"></script><script src="/js/guide.js"></script></body></html>